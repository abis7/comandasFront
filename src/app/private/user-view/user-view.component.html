<div class="p-4 sm:p-6 lg:p-8 bg-gray-50 min-h-screen font-outfit">

  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8">
    <div>
      <h1 class="text-3xl font-extrabold text-gray-900 tracking-tight">
        <span class="text-primary">Gestión</span> de Usuarios
      </h1>
      <p class="text-gray-500 mt-1">Administra los roles y perfiles de los usuarios del sistema</p>
    </div>

    <button [routerLink]="'/private/user-create'"
      class="group btn bg-primary text-black border-none gap-2 shadow-lg hover:shadow-xl transition-all duration-300 transform hover:scale-[1.02] rounded-xl font-bold px-6 py-3">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 group-hover:rotate-12 transition-transform duration-500"
        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
        <circle cx="9" cy="7" r="4" />
        <line x1="19" y1="8" x2="19" y2="14" />
        <line x1="22" y1="11" x2="16" y2="11" />
      </svg>
      Nuevo Usuario
    </button>
  </div>

  <div class="bg-white rounded-3xl shadow-2xl overflow-hidden border border-gray-100">

    <div class="p-6 border-b border-gray-100">
      <div class="relative max-w-lg">
        <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8" />
            <path d="m21 21-4.35-4.35" />
          </svg>
        </div>
        <input type="text" (keyup)="applyFilter($event)" #input placeholder="Buscar por nombre, teléfono o rol..."
          class="input w-full pl-12 pr-4 py-3 bg-gray-50 border-2 border-gray-200 focus:border-primary focus:ring-2 focus:ring-primary/20 rounded-xl transition-all duration-300 text-base">
      </div>
    </div>

    <div class="overflow-x-auto">
      <table mat-table [dataSource]="dataSource" matSort class="w-full">

        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef mat-sort-header
            class="!bg-gray-50 !text-gray-600 !font-bold !py-4 !px-6 text-left !uppercase !text-sm">
            <div class="flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                <circle cx="12" cy="7" r="4" />
              </svg>
              Nombre
            </div>
          </th>
          <td mat-cell *matCellDef="let row" class="!py-4 !px-6">
            <div class="flex items-center gap-3">
              <div
                class="w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center text-primary font-bold text-lg ring-1 ring-primary/50">
                {{ row.name?.charAt(0)?.toUpperCase() }}
              </div>
              <span class="font-medium text-gray-800">{{ row.name }}</span>
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="phone">
          <th mat-header-cell *matHeaderCellDef mat-sort-header
            class="!bg-gray-50 !text-gray-600 !font-bold !py-4 !px-6 text-left !uppercase !text-sm">
            <div class="flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2">
                <path
                  d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z" />
              </svg>
              Teléfono
            </div>
          </th>
          <td mat-cell *matCellDef="let row" class="!py-4 !px-6 text-gray-600">
            {{ row.phone || 'N/A' }}
          </td>
        </ng-container>

        <ng-container matColumnDef="rol">
          <th mat-header-cell *matHeaderCellDef mat-sort-header
            class="!bg-gray-50 !text-gray-600 !font-bold !py-4 !px-6 text-left !uppercase !text-sm">
            <div class="flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
              </svg>
              Rol
            </div>
          </th>
          <td mat-cell *matCellDef="let row" class="!py-4 !px-6">
            <span class="px-3 py-1 rounded-full text-sm font-semibold tracking-wide capitalize" [ngClass]="{
                    'bg-red-100 text-red-700 ring-1 ring-red-300/50': row.rol === 0,
                    'bg-blue-100 text-blue-700 ring-1 ring-blue-300/50': row.rol === 1,
                    'bg-green-100 text-green-700 ring-1 ring-green-300/50': row.rol === 2,
                    'bg-yellow-100 text-yellow-700 ring-1 ring-yellow-300/50': row.rol === 3
                  }">
              {{ mapRol(row.rol) }}
            </span>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" [routerLink]="'/private/user-edit/' + row.idusers"
          class="hover:bg-primary/5 cursor-pointer transition-colors duration-200"></tr>

        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell !py-20 !text-center" colspan="3">
            <div class="flex flex-col items-center gap-4 text-gray-400">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 opacity-70" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="1.5">
                <path d="M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20z" />
                <path d="m16 16-4-4-4 4m4-10v8" />
              </svg>
              <p class="text-lg font-medium">No se encontraron usuarios</p>
              @if (input.value) {
              <p class="text-sm text-gray-500">Prueba ajustando el término de búsqueda: "<span
                  class="font-semibold text-gray-700">{{ input.value }}</span>"</p>
              }
            </div>
          </td>
        </tr>
      </table>
    </div>

    <div class="border-t border-gray-100 p-2 sm:p-4">
      <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" aria-label="Seleccionar página de usuarios"
        class="!bg-transparent"></mat-paginator>
    </div>
  </div>
</div>